// lib/promos.ts

export type Promo = {
    id: string;
    title: string;
    active: boolean;
    keywords: string[];        // ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏ß‡∏£‡πÄ‡∏à‡∏≠‡πÇ‡∏õ‡∏£‡∏ô‡∏µ‡πâ
    lines: string[];           // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    limitNote?: string;        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î/‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
  };
  
  const LINE_HANDLE = process.env.LINE_OA_HANDLE ?? "@mechoke";
  const BRAND_NAME = process.env.BRAND_NAME ?? "‡∏°‡∏µ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏≠‡∏ó‡∏Ñ‡∏≠‡∏°";
  
  // ===== ‡πÇ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢ =====
  export const PROMOS: Promo[] = [
    {
      id: "first-deposit-300-gift",
      title: "‡∏ù‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å 300 ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°‡∏ü‡∏£‡∏µ",
      active: true,
      keywords: [
        "‡πÇ‡∏õ‡∏£", "‡πÇ‡∏õ‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ", "promotion", "‡∏ù‡∏≤‡∏Å 300", "‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°", "‡πÇ‡∏õ‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", "‡πÇ‡∏õ‡∏£‡∏ù‡∏≤‡∏Å‡πÅ‡∏£‡∏Å",
      ],
      lines: [
        "üéÅ ‡πÇ‡∏õ‡∏£‡∏ù‡∏≤‡∏Å‡πÅ‡∏£‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©!",
        "‚Ä¢ ‡∏ù‡∏≤‡∏Å 300 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°‡∏ü‡∏£‡∏µ 1 ‡∏ä‡∏¥‡πâ‡∏ô (‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô)",
        "‚Ä¢ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô",
        `‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà LINE OA üëâ ${LINE_HANDLE}`,
      ],
      limitNote: "‚Äª ‡∏Ç‡∏≠‡∏á‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞",
    },
    {
      id: "checkin-7days",
      title: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 300 ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°",
      active: true,
      keywords: [
        "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô", "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô7‡∏ß‡∏±‡∏ô", "check in", "‡πÇ‡∏õ‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô", "7 ‡∏ß‡∏±‡∏ô", "‡πÇ‡∏õ‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á",
      ],
      lines: [
        "üìÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö 7 ‡∏ß‡∏±‡∏ô ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°‡∏ü‡∏£‡∏µ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!",
        "‚Ä¢ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 300 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 7 ‡∏ß‡∏±‡∏ô",
        "‚Ä¢ ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô",
        `‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà ${LINE_HANDLE}`,
      ],
      limitNote: "‚Äª ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î/‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô",
    },
    {
      id: "vip-monthly",
      title: "‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô VIP ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
      active: true,
      keywords: ["vip", "‡∏™‡∏∞‡∏™‡∏°", "‡πÇ‡∏Å‡∏•‡∏î‡πå", "‡∏ã‡∏¥‡∏•‡πÄ‡∏ß‡∏≠‡∏£‡πå", "‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©"],
      lines: [
        "üèÜ ‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏≠‡∏î‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå VIP ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
        "‚Ä¢ ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™/‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô",
        `‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà ${LINE_HANDLE}`,
      ],
    },
  ];
  
  // ===== ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢: ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á Active ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î =====
  export function promoSummary(): string {
    const actives = PROMOS.filter(p => p.active);
    const list = actives.map(p => `‚Ä¢ ${p.title}`).join("\n");
    return [
      `üéâ ‡πÇ‡∏õ‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á ${BRAND_NAME}`,
      list || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ",
      `‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà ${LINE_HANDLE}`,
    ].join("\n");
  }
  
  // ===== ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢: ‡∏´‡∏≤‡πÇ‡∏õ‡∏£‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢) =====
  export function promoFromText(text: string): Promo | null {
    const t = text.toLowerCase();
    for (const p of PROMOS) {
      if (!p.active) continue;
      const hit = p.keywords.some(k => t.includes(k.toLowerCase()));
      if (hit) return p;
    }
    // ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ keyword ‡πÉ‡∏î ‡πÜ ‡πÉ‡∏´‡πâ fallback ‡πÇ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å
    const defaultPromo = PROMOS.find(p => p.active && p.id === "first-deposit-300-gift");
    return defaultPromo || null;
  }
  
  // ===== ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢: ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ =====
  export function buildPromoReplyFromText(text: string): string | null {
    const promo = promoFromText(text);
    if (!promo) return null;
    const body = [...promo.lines];
    if (promo.limitNote) body.push(promo.limitNote);
    return body.join("\n");
  }